---
import type { CollectionEntry } from 'astro:content';
import { Schema } from 'astro-seo-schema';
import { SITE_BASE_URL } from '~/constants/site';

interface Props {
	post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const postUrl = new URL(`/blog/${post.id}`, Astro.site).toString();

// Calculate reading time (rough estimate)
const wordsPerMinute = 200;
const wordCount = post.body ? post.body.split(/\s+/g).length : 0;
const readingTime = Math.ceil(wordCount / wordsPerMinute);
---

<Schema
	item={{
		'@context': 'https://schema.org',
		'@type': 'BlogPosting',
		headline: post.data.title,
		author: {
			'@type': 'Person',
			name: 'Jannik Wempe',
			url: SITE_BASE_URL,
		},
		image: new URL(typeof post.data.cover === 'string' ? post.data.cover : post.data.cover.src, Astro.site).toString(),
		datePublished: post.data.datePublished.toISOString(),
		dateCreated: post.data.datePublished.toISOString(),
		description: post.data.excerpt,
		wordCount: wordCount,
		timeRequired: `PT${readingTime}M`,
		url: postUrl,
		inLanguage: 'en-US',
		mainEntityOfPage: {
			'@type': 'WebPage',
			'@id': postUrl,
		},
		keywords: post.data.tags?.join(', '),
		publisher: {
			'@type': 'Person',
			name: 'Jannik Wempe',
			url: SITE_BASE_URL,
		},
	}}
/>
