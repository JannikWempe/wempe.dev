---
import type { CollectionEntry } from 'astro:content';
import { Schema } from 'astro-seo-schema';
import { SITE_BASE_URL } from '~/constants/site';
import { render } from 'astro:content';
import { isExternalCoverImage } from '~/utils/image';

interface Props {
	post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;

const { remarkPluginFrontmatter } = await render(post);

const postUrl = new URL(`/blog/${post.id}`, Astro.site).toString();
---

<Schema
	item={{
		'@context': 'https://schema.org',
		'@type': 'BlogPosting',
		headline: post.data.title,
		author: {
			'@type': 'Person',
			name: 'Jannik Wempe',
			url: SITE_BASE_URL,
		},
		image: isExternalCoverImage(post.data.cover)
			? post.data.cover
			: new URL(post.data.cover.src, Astro.site).toString(),
		datePublished: post.data.datePublished.toISOString(),
		dateCreated: post.data.datePublished.toISOString(),
		description: post.data.excerpt,
		wordCount: remarkPluginFrontmatter.readingTime.words,
		timeRequired: `PT${Math.ceil(remarkPluginFrontmatter.readingTime.minutes)}M`,
		url: postUrl,
		inLanguage: 'en-US',
		mainEntityOfPage: {
			'@type': 'WebPage',
			'@id': postUrl,
		},
		keywords: post.data.tags?.join(', '),
		publisher: {
			'@type': 'Person',
			name: 'Jannik Wempe',
			url: SITE_BASE_URL,
		},
	}}
/>
