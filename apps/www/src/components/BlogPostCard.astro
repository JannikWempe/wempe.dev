---
import { Icon } from 'astro-icon/components';
import type { HTMLAttributes } from 'astro/types';
import { Image, type ImgAttributes } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { twMerge } from 'tailwind-merge';
import { formatDate } from '~/utils/time';
import { render } from 'astro:content';
import Badge from '~/components/ui/Badge.astro';

interface Props extends HTMLAttributes<'article'> {
	post: CollectionEntry<'blog'>;
	imageProps?: Omit<ImgAttributes, 'src' | 'alt' | 'width' | 'height' | 'class'>;
}

const { post, class: classes, imageProps, ...rest } = Astro.props;
const { title, excerpt, datePublished, cover, slug, tags } = post.data;
const formattedDate = formatDate(datePublished);

const { remarkPluginFrontmatter } = await render(post);
---

<article
	class={twMerge(
		'group relative rounded-2xl border border-slate-200/60 bg-white shadow-sm transition-all duration-300 hover:border-indigo-200 hover:shadow-lg hover:shadow-indigo-100/50 focus-within:ring-2 focus-within:ring-indigo-500 focus-within:ring-offset-2',
		classes
	)}
	{...rest}
>
	<a href={`/blog/${slug}`} class="block overflow-hidden rounded-t-2xl">
		<Image
			transition:name={`cover-${slug}`}
			src={cover}
			alt={title}
			width={650}
			height={341}
			format={cover.format !== 'gif' ? 'avif' : 'gif'}
			class="w-full object-cover transition-transform duration-300 group-hover:scale-105"
			{...imageProps}
		/>
	</a>
	<div class="p-6">
		{
			tags && tags.length > 0 && (
				<div class="mb-3 flex flex-wrap gap-2">
					{tags.map((tag: string) => (
						<Badge
							as="a"
							href={`/blog/tag/${tag}`}
							variant="slate"
							size="sm"
							class="transition-colors hover:bg-indigo-50 hover:text-indigo-700 hover:ring-indigo-600/10"
						>
							{tag}
						</Badge>
					))}
				</div>
			)
		}
		<a href={`/blog/${slug}`} class="block">
			<h2
				transition:name={`title-${slug}`}
				class="text-xl font-bold tracking-tight text-slate-900 transition-colors group-hover:text-indigo-600"
			>
				{title}
			</h2>
		</a>
		<div class="mt-2 flex items-center gap-3 text-sm text-slate-500">
			<div class="flex items-center gap-1.5">
				<Icon name="lucide:calendar" class="h-4 w-4" />
				<time datetime={formattedDate}>
					{formattedDate}
				</time>
			</div>
			<div class="flex items-center gap-1.5">
				<Icon name="lucide:clock" class="h-4 w-4" />
				<span>
					{remarkPluginFrontmatter.readingTime.text}
				</span>
			</div>
		</div>
		<p class="mt-3 line-clamp-3 text-slate-600 leading-relaxed">{excerpt}</p>
	</div>
</article>
